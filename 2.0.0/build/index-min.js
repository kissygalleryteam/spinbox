/*! spinbox - v2.0.0 - 2013-07-22 11:02.0.05 PM
* Copyright (c) 2013 易敛; Licensed  */
KISSY.add("kg/spinbox/2.0.0/index",function(a,b,c){function d(b,c){var f=this;c=a.merge({target:e(b)},c),d.superclass.constructor.call(f,c),f.render()}var e=b.all,f="";return a.extend(d,c,{render:function(){var a=this,b=a.get("target");if(!b.length||a._isNativeSpinBox())return!1;var c=a.get("cls").init;b.hasClass(c)||b.addClass(c),a._loadCss(),a._addHTML(),a._eventOnChangeNum(),a._eventOnValide()},_isNativeSpinBox:function(){var a=this,b=a.get("target");return"number"==b.attr("type")?!0:!1},_addHTML:function(){var a=this,b=a.get("target"),c=this.get("cls"),d=a.get("ariaLabel");b.each(function(a){var b=a.parent(),f=e('<span class="'+c.container+'"></span>'),g=e('<a href="#!/plus" class="'+c.plus+" "+c.sign+'" role="button">+</a>'),h=e('<a href="#!/minus" class="'+c.minus+" "+c.sign+'"  role="button">-</a>');a.attr({"aria-label":d}),f.append(h).append(a).append(g),b.append(f)})},_eventOnChangeNum:function(){var b=this,c=b.get("cls"),d=e("."+c.sign);d.on("keyup keydown mouseup mousedown",function(d){var g=e(this),h=g.parent(1),i=h.children("."+c.init),j=Number(a.trim(i.val())),k=Number(a.trim(i.attr("data-range")))||1,l=b.get("onValueChange"),m=1e3,n=function(){d.target.className.indexOf(c.plus)>-1?j+=k:d.target.className.indexOf(c.minus)>-1&&(j-=k),b._limitRange(j,i)};("keydown"==d.type||"mousedown"==d.type)&&(n(),f=setTimeout(function(){n(),m=100,f=setTimeout(arguments.callee,m)},m)),("keyup"==d.type||"mouseup"==d.type)&&(f&&clearInterval(f),l&&l.call(b,{target:i,trigger:g}))})},_eventOnValide:function(){var b,c=this,d=c.get("target"),g=c.get("onValueChange");d.on("focus",function(){b=e(this).val()}),d.on("blur",function(){var d=e(this);c._formatNum(d),c._limitRange(Number(a.trim(d.val())),d),f&&clearInterval(f),b!==d.val()&&g&&g.call(c,{target:d,trigger:d})})},_toFloat:function(a){return parseFloat(a)},_formatNum:function(a){var b=this,c=Number(a.attr("data-min"))||1,d=b._toFloat(a.val().replace(/[^\d\.]/g,""));d=isNaN(d)?c:Math.max(d,c);var e="true"==a.attr("data-hasdecimal")?2:0;a.val(d.toFixed(e))},_limitRange:function(a,b){var c=this,d=b,f=d.parent(1),g=c._toFloat,h=c.get("cls"),i=g(d.attr("data-min"))||1,j=g(d.attr("data-max"))||1,k=i&&Math.max(i,a);k=j&&Math.min(j,k);var l="true"==d.attr("data-hasdecimal")?2:0;d.val(k.toFixed(l)),k===i?e("."+h.minus,f).addClass(h.disabled):k===j?e("."+h.plus,f).addClass(h.disabled):e("."+h.sign,f).removeClass(h.disabled)},_loadCss:function(){var b=this,c=b.get("cssUrl");""!=c&&a.use(c)}},{ATTRS:{target:{value:"",setter:function(a){return e(a)},getter:function(a){return e(a)}},cls:{value:{init:"ks-spinbox",sign:"ks-spinbox-sign",plus:"ks-spinbox-plus",minus:"ks-spinbox-minus",container:"ks-plus-minus-operation",disabled:"ks-spinbox-disabled"}},onValueChange:{value:function(){}},ariaLabel:{value:""},cssUrl:{value:"kg/spinbox/1.4/index.css"}}}),d},{requires:["node","base"]});